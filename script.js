// =====================================
// Multilingual Translations
// =====================================
const translations = {
    'zh-TW': {
        page_title: 'å¤–åœ‹å­¸ç”Ÿç”³è«‹å±…ç•™è­‰æŒ‡å— | Residence Permit Application Guide',
        main_title: 'å¤–åœ‹å­¸ç”Ÿç”³è«‹å±…ç•™è­‰å®Œæ•´æŒ‡å—',
        subtitle: 'è·Ÿè‘—å½±ç‰‡ä¸€æ­¥æ­¥å®Œæˆç”³è«‹',
        important_notice: 'é‡è¦æé†’',
        notice_1: 'ç¬¬ä¸€æ¬¡è¾¦ç†å¯ä»¥ç·šä¸Šç”³è«‹',
        notice_2: 'é«”æª¢éƒ¨åˆ†ä¸€å®šè¦å®Œæˆé«”æª¢æ‰èƒ½é ˜å–å±…ç•™è­‰',
        notice_3: 'å±…ç•™è­‰é€¾æœŸå°‡è™•æ–°è‡ºå¹£1è¬å…ƒè‡³5è¬å…ƒç½°é°',
        step1_title: 'æº–å‚™æ–‡ä»¶',
        step2_title: 'è¨»å†Šå¸³è™Ÿ',
        step3_title: 'å¡«å¯«ç”³è«‹',
        step4_title: 'ç¹³è²»å®Œæˆ',
        step1_heading: 'æ­¥é©Ÿä¸€ï¼šæº–å‚™å¿…è¦æ–‡ä»¶',
        step2_heading: 'æ­¥é©ŸäºŒï¼šè¨»å†Šç§»æ°‘ç½²å¸³è™Ÿ',
        step3_heading: 'æ­¥é©Ÿä¸‰ï¼šå¡«å¯«ç·šä¸Šç”³è«‹è¡¨',
        step4_heading: 'æ­¥é©Ÿå››ï¼šç¹³è²»èˆ‡é ˜è­‰',
        required_docs: 'å¿…å‚™æ–‡ä»¶æ¸…å–®',
        doc_passport: 'è­·ç…§',
        doc_passport_desc: 'è­·ç…§æ­£æœ¬åŠå½±æœ¬',
        doc_visa: 'å±…ç•™ç°½è­‰',
        doc_visa_desc: 'è¨»è¨˜ã€Œå¤–åœ‹ç•™å­¸ç”Ÿã€çš„å±…ç•™ç°½è­‰',
        doc_enrollment: 'åœ¨å­¸è­‰æ˜Ž',
        doc_enrollment_desc: 'ç¹³è²»è¨»å†Šå¾Œå¯ä¸‹è¼‰æˆ–è‡³æ•™å‹™è™•ç”³è«‹',
        doc_residence: 'ä½å®¿è­‰æ˜Ž',
        doc_residence_desc: 'å®¿èˆä½å®¿è­‰æ˜Žæˆ–ç§Ÿå±‹å¥‘ç´„',
        doc_photo: 'ç…§ç‰‡',
        doc_photo_desc: 'ç™½è‰²èƒŒæ™¯2å‹åŠèº«è„«å¸½æ­£é¢ç›¸ç‰‡',
        doc_fee: 'è²»ç”¨',
        doc_fee_desc: 'æ–°è‡ºå¹£1,000å…ƒï¼ˆä¸€å¹´æœŸï¼‰',
        enrollment_cert_title: 'ðŸ“„ å¦‚ä½•å–å¾—åœ¨å­¸è­‰æ˜Ž',
        method1: 'æ–¹æ³•ä¸€ï¼šä½¿ç”¨ NTNU APP ä¸‹è¼‰ï¼ˆæŽ¨è–¦ï¼‰',
        method2: 'æ–¹æ³•äºŒï¼ši-Portal ç¶²é ä¸‹è¼‰',
        method3: 'æ–¹æ³•ä¸‰ï¼šè‡³æ•™å‹™è™•ç”³è«‹',
        enrollment_app_step1: 'ä¸‹è¼‰ä¸¦ç™»å…¥ã€ŒNTNU APPã€ï¼ˆåœ‹ç«‹è‡ºç£å¸«ç¯„å¤§å­¸APPï¼‰',
        enrollment_app_step2: 'é€²å…¥ã€Œæˆ‘çš„æ ¡åœ’ã€â†’ã€Œå­¸ç”Ÿå°ˆå€ã€',
        enrollment_app_step3: 'é¸æ“‡ã€Œæ•™å‹™è³‡è¨Šã€â†’ã€Œåœ¨å­¸è­‰æ˜Žã€',
        enrollment_app_step4: 'é¸æ“‡ç•¶å­¸æœŸä¸¦é»žæ“Šã€Œä¸‹è¼‰PDFã€',
        app_note: 'ðŸ’¡ APPä¸‹è¼‰çš„åœ¨å­¸è­‰æ˜Žå·²å…§å»ºæ•™å‹™è™•é›»å­ç« æˆ³ï¼Œç„¡éœ€å¦å¤–ç”¨å°ï¼',
        enrollment_step1: 'ç™»å…¥æ ¡å‹™è¡Œæ”¿è³‡è¨Šå…¥å£ç¶²',
        enrollment_step2: 'é€²å…¥ã€Œæ•™å‹™è³‡è¨Šç³»çµ±ã€â†’ã€Œå­¸ç±ç›¸é—œã€',
        enrollment_step3: 'é¸æ“‡ã€Œç•¶å­¸æœŸåœ¨å­¸è­‰æ˜Žã€ä¸¦ä¸‹è¼‰',
        enrollment_step4: 'ç¢ºèªå·²ç¹³å®Œå­¸è²»',
        enrollment_step5: 'å¸¶è‘—ç¹³è²»æ”¶æ“šåˆ°æ•™å‹™è™•è¨»å†Šçµ„ç”³è«‹ï¼ˆè²»ç”¨ï¼šNT$10/ä»½ï¼‰',
        enrollment_important_note: 'âš ï¸ é‡è¦æé†’ï¼šå‰›ç¹³å®Œå­¸è²»çš„åŒå­¸ï¼Œç³»çµ±å¯èƒ½éœ€è¦2-3å€‹å·¥ä½œå¤©æ›´æ–°ç‹€æ…‹ï¼Œæ‰èƒ½ä¸‹è¼‰åœ¨å­¸è­‰æ˜Žã€‚',
        go_to_portal: 'å‰å¾€æ ¡å‹™ç³»çµ± â†’',
        residence_cert_title: 'ðŸ  å¦‚ä½•å–å¾—ä½å®¿è­‰æ˜Ž',
        dorm_student: 'ä½å­¸æ ¡å®¿èˆï¼š',
        residence_step1: 'ç¢ºèªå·²ç¹³äº¤ä½å®¿è²»ç”¨',
        residence_step2: 'ç™»å…¥æ ¡å‹™è¡Œæ”¿è³‡è¨Šå…¥å£ç¶²',
        residence_step3: 'é€²å…¥ã€Œå­¸ç”Ÿå®¿èˆç›¸é—œç³»çµ±ã€ä¸‹è¼‰ä½å®¿è­‰æ˜Ž',
        off_campus: 'ä½æ ¡å¤–ï¼š',
        rental_contract: 'è«‹æä¾›èˆ‡æˆ¿æ±ç°½è¨‚çš„ç§Ÿè³ƒå¥‘ç´„ï¼ˆç§Ÿå±‹å¥‘ç´„ï¼‰',
        video_not_supported: 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾',
        video1_caption: 'è§€çœ‹å½±ç‰‡å­¸ç¿’å¦‚ä½•è¨»å†Šç§»æ°‘ç½²ç·šä¸Šç”³è¾¦ç³»çµ±å¸³è™Ÿ',
        video2_caption: 'è·Ÿè‘—å½±ç‰‡ä¸€æ­¥æ­¥å®Œæˆå±…ç•™è­‰ç”³è«‹è¡¨å¡«å¯«',
        video3_caption: 'äº†è§£å¦‚ä½•å®Œæˆç¹³è²»ä¸¦é ˜å–å±…ç•™è­‰',
        registration_steps: 'è¨»å†Šæ­¥é©Ÿèªªæ˜Ž',
        reg_step1: 'å‰å¾€ç§»æ°‘ç½²ç·šä¸Šç”³è¾¦ç¶²ç«™ï¼šhttps://reurl.cc/GEbr2p',
        reg_step2: 'é»žé¸ã€Œè¨»å†Šæ–°å¸³è™Ÿã€',
        reg_step3: 'å¡«å¯«å€‹äººåŸºæœ¬è³‡æ–™ï¼ˆè­·ç…§è³‡è¨Šã€è¯çµ¡æ–¹å¼ç­‰ï¼‰',
        reg_step4: 'è¨­å®šå¸³è™Ÿå¯†ç¢¼',
        reg_step5: 'é©—è­‰é›»å­éƒµä»¶',
        reg_step6: 'å®Œæˆè¨»å†Š',
        application_steps: 'ç”³è«‹æ­¥é©Ÿèªªæ˜Ž',
        app_step1: 'ç™»å…¥ç§»æ°‘ç½²ç·šä¸Šç”³è¾¦ç³»çµ±',
        app_step2: 'é¸æ“‡ã€Œå¤–åƒ‘å±…ç•™è­‰ç”³è«‹ã€',
        app_step3: 'å¡«å¯«å€‹äººåŸºæœ¬è³‡æ–™',
        app_step4: 'ä¸Šå‚³å¿…è¦æ–‡ä»¶ï¼š',
        upload_enrollment: 'åœ¨å­¸è­‰æ˜Ž',
        upload_residence: 'ä½å®¿è­‰æ˜Ž',
        upload_photo: '2å‹ç…§ç‰‡é›»å­æª”',
        app_step5: 'ç¢ºèªè³‡æ–™ç„¡èª¤',
        app_step6: 'é€å‡ºç”³è«‹',
        permit_duration: 'â° å±…ç•™è­‰æ•ˆæœŸèªªæ˜Ž',
        duration_note1: 'åˆæ¬¡å…¥åœ‹æœªè¨»å†Šï¼ˆæœªä¸Šå‚³åœ¨å­¸è­‰æ˜Žï¼‰ï¼šæ ¸ç™¼6å€‹æœˆæ•ˆæœŸ',
        duration_note2: 'åˆæ¬¡å…¥åœ‹å·²è¨»å†Šï¼ˆä¸Šå‚³åœ¨å­¸è­‰æ˜Žï¼‰ï¼šæ ¸ç™¼1å¹´æ•ˆæœŸ',
        duration_note3: 'å±…ç•™è­‰åˆ°æœŸå‰3å€‹æœˆæ‡‰ç”³è«‹å»¶å±•',
        payment_steps: 'ç¹³è²»æ­¥é©Ÿèªªæ˜Ž',
        pay_step1: 'ç·šä¸Šç”³è«‹å®Œæˆå¾Œï¼Œç³»çµ±æœƒç”¢ç”Ÿç¹³è²»å–®',
        pay_step2: 'åˆ—å°ç¹³è²»å–®æˆ–è¨˜ä¸‹ç¹³è²»ä»£ç¢¼',
        pay_step3: 'å‰å¾€ä¾¿åˆ©å•†åº—ã€éƒµå±€æˆ–éŠ€è¡Œç¹³è²»ï¼ˆNT$1,000ï¼‰',
        pay_step4: 'ä¿ç•™ç¹³è²»æ”¶æ“š',
        pay_step5: 'ç­‰å¾…å¯©æ ¸é€šçŸ¥ï¼ˆç´„7-14å€‹å·¥ä½œå¤©ï¼‰',
        pay_step6: 'æ”¶åˆ°é€šçŸ¥å¾Œï¼Œæ”œå¸¶è­·ç…§å’Œæ”¶æ“šå‰å¾€ç§»æ°‘ç½²é ˜è­‰',
        congratulations: 'æ­å–œï¼',
        completion_message: 'å®Œæˆä»¥ä¸Šæ­¥é©Ÿå¾Œï¼Œæ‚¨å°±æˆåŠŸç”³è«‹äº†å°ç£å±…ç•™è­‰ï¼',
        important_reminders: 'ðŸ“Œ é‡è¦äº‹é …æé†’',
        reminder1: 'å±…ç•™è­‰åˆ°æœŸå‰3å€‹æœˆæ‡‰ç”³è«‹å»¶å±•',
        reminder2: 'è®Šæ›´å±…ä½åœ°å€é ˆæ–¼30æ—¥å…§è¾¦ç†è®Šæ›´ç™»è¨˜',
        reminder3: 'å±…ç•™è­‰é€¾æœŸå°‡è™•æ–°è‡ºå¹£1è¬å…ƒè‡³5è¬å…ƒç½°é°',
        reminder4: 'è«‹å¦¥å–„ä¿ç®¡å±…ç•™è­‰ï¼Œéºå¤±éœ€ç«‹å³ç”³å ±',
        need_help: 'éœ€è¦å”åŠ©ï¼Ÿ',
        immigration_office: 'å…§æ”¿éƒ¨ç§»æ°‘ç½²',
        immigration_website: 'ç¶²ç«™ï¼šç·šä¸Šç”³è¾¦ç³»çµ±',
        school_office: 'å­¸æ ¡åœ‹éš›è™•',
        school_location: 'ä½ç½®ï¼šå’Œå¹³æ ¡å€ æ™®é€šå¤§æ¨“1æ¨“',
        next_step: 'ä¸‹ä¸€æ­¥ â†’',
        prev_step: 'â† ä¸Šä¸€æ­¥',
        start_over: 'é‡æ–°é–‹å§‹',
        footer_text: 'Â© 2024 å°ç£å¸«ç¯„å¤§å­¸ - å¤–åœ‹å­¸ç”Ÿå±…ç•™è­‰ç”³è«‹æŒ‡å—'
    },
    'en': {
        page_title: 'Taiwan Residence Permit Application Guide for International Students',
        main_title: 'Complete Guide for Residence Permit Application',
        subtitle: 'Follow the videos step by step',
        important_notice: 'Important Notice',
        notice_1: 'First-time applications can be submitted online',
        notice_2: 'Health examination is required to receive residence permit',
        notice_3: 'Overdue permit will result in NT$10,000-50,000 fine',
        step1_title: 'Prepare Documents',
        step2_title: 'Register Account',
        step3_title: 'Fill Application',
        step4_title: 'Payment',
        step1_heading: 'Step 1: Prepare Required Documents',
        step2_heading: 'Step 2: Register Immigration Office Account',
        step3_heading: 'Step 3: Fill Out Online Application',
        step4_heading: 'Step 4: Payment and Collection',
        required_docs: 'Required Documents',
        doc_passport: 'Passport',
        doc_passport_desc: 'Original and copy of passport',
        doc_visa: 'Resident Visa',
        doc_visa_desc: 'Resident visa marked "Foreign Student"',
        doc_enrollment: 'Enrollment Certificate',
        doc_enrollment_desc: 'Download after registration or apply at Registrar Office',
        doc_residence: 'Residence Proof',
        doc_residence_desc: 'Dormitory certificate or rental contract',
        doc_photo: 'Photo',
        doc_photo_desc: '2-inch photo with white background',
        doc_fee: 'Fee',
        doc_fee_desc: 'NT$1,000 (one-year permit)',
        enrollment_cert_title: 'ðŸ“„ How to Obtain Enrollment Certificate',
        method1: 'Method 1: Download via NTNU APP (Recommended)',
        method2: 'Method 2: i-Portal Web Download',
        method3: 'Method 3: Apply at Registrar Office',
        enrollment_app_step1: 'Download and log in to "NTNU APP" (National Taiwan Normal University APP)',
        enrollment_app_step2: 'Go to "My School" â†’ "Student Zone"',
        enrollment_app_step3: 'Select "Academic Affairs" â†’ "Enrollment Certificate"',
        enrollment_app_step4: 'Select current semester and click "Download PDF"',
        app_note: 'ðŸ’¡ Certificates downloaded via APP include built-in official digital stamp - no additional stamping needed!',
        enrollment_step1: 'Log in to Student Portal',
        enrollment_step2: 'Enter "Academic Affairs System" â†’ "Student Status"',
        enrollment_step3: 'Select "Current Semester Enrollment Certificate" and download',
        enrollment_step4: 'Confirm tuition payment',
        enrollment_step5: 'Bring receipt to Registrar Office (Fee: NT$10/copy)',
        enrollment_important_note: 'âš ï¸ Important: After paying tuition, it may take 2-3 working days for the system to update before you can download the certificate.',
        go_to_portal: 'Go to Portal â†’',
        residence_cert_title: 'ðŸ  How to Obtain Residence Proof',
        dorm_student: 'Dormitory Students:',
        residence_step1: 'Confirm payment of accommodation fees',
        residence_step2: 'Log in to Student Portal',
        residence_step3: 'Download certificate from "Dormitory System"',
        off_campus: 'Off-Campus:',
        rental_contract: 'Provide rental contract signed with landlord',
        video_not_supported: 'Your browser does not support video playback',
        video1_caption: 'Learn how to register an immigration online system account',
        video2_caption: 'Follow the video to complete the application form',
        video3_caption: 'Learn how to complete payment and collect permit',
        registration_steps: 'Registration Steps',
        reg_step1: 'Visit Immigration Office website: https://reurl.cc/GEbr2p',
        reg_step2: 'Click "Register New Account"',
        reg_step3: 'Fill in personal information (passport, contact, etc.)',
        reg_step4: 'Set username and password',
        reg_step5: 'Verify email address',
        reg_step6: 'Complete registration',
        application_steps: 'Application Steps',
        app_step1: 'Log in to Immigration online system',
        app_step2: 'Select "Alien Residence Certificate Application"',
        app_step3: 'Fill in personal information',
        app_step4: 'Upload required documents:',
        upload_enrollment: 'Enrollment certificate',
        upload_residence: 'Residence proof',
        upload_photo: '2-inch photo file',
        app_step5: 'Confirm information',
        app_step6: 'Submit application',
        permit_duration: 'â° Permit Duration',
        duration_note1: 'First entry without enrollment: 6-month permit',
        duration_note2: 'First entry with enrollment: 1-year permit',
        duration_note3: 'Apply for extension 3 months before expiry',
        payment_steps: 'Payment Steps',
        pay_step1: 'Payment slip will be generated after application',
        pay_step2: 'Print payment slip or note payment code',
        pay_step3: 'Pay at convenience store, post office or bank (NT$1,000)',
        pay_step4: 'Keep payment receipt',
        pay_step5: 'Wait for approval (7-14 working days)',
        pay_step6: 'Collect permit at Immigration Office with passport and receipt',
        congratulations: 'Congratulations!',
        completion_message: 'You have successfully applied for Taiwan residence permit!',
        important_reminders: 'ðŸ“Œ Important Reminders',
        reminder1: 'Apply for extension 3 months before expiry',
        reminder2: 'Report address changes within 30 days',
        reminder3: 'Overdue permit will result in NT$10,000-50,000 fine',
        reminder4: 'Keep permit safe, report immediately if lost',
        need_help: 'Need Help?',
        immigration_office: 'Immigration Office',
        immigration_website: 'Website: Online Application System',
        school_office: 'School International Office',
        school_location: 'Location: General Building 1F, Heping Campus',
        next_step: 'Next Step â†’',
        prev_step: 'â† Previous Step',
        start_over: 'Start Over',
        footer_text: 'Â© 2024 NTNU - International Student Residence Permit Guide'
    }
};

// Additional languages (Japanese, Korean, Vietnamese, Thai, Indonesian, French, German, Russian)
// Abbreviated for brevity - full translations would be added here

let currentLang = 'zh-TW';
let currentStep = 1;

// =====================================
// Initialize
// =====================================
document.addEventListener('DOMContentLoaded', () => {
    initLanguage();
    initNav();
    updateProgress();
});

// =====================================
// Language Functions
// =====================================
function initLanguage() {
    const savedLang = localStorage.getItem('selectedLanguage') || 'zh-TW';
    switchLanguage(savedLang);

    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.dataset.lang;
            switchLanguage(lang);
        });
    });
}

function switchLanguage(lang) {
    if (!translations[lang]) {
        lang = 'zh-TW';
    }

    currentLang = lang;
    localStorage.setItem('selectedLanguage', lang);

    // Update active button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });

    // Update all translatable elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang][key]) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                el.placeholder = translations[lang][key];
            } else {
                el.textContent = translations[lang][key];
            }
        }
    });

    // Update page title
    document.title = translations[lang].page_title;
}

// =====================================
// Navigation Functions
// =====================================
function initNav() {
    // Mark completed steps
    updateStepStatus();
}

function nextStep() {
    if (currentStep < 4) {
        currentStep++;
        showStep(currentStep);
        updateProgress();
        updateStepStatus();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function prevStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
        updateProgress();
        updateStepStatus();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function showStep(step) {
    // Hide all step contents
    document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
    });

    // Show current step content
    const stepContent = document.querySelector(`.step-content[data-content="${step}"]`);
    if (stepContent) {
        stepContent.classList.add('active');
    }

    // Update step indicators
    document.querySelectorAll('.step').forEach((el, index) => {
        el.classList.toggle('active', index + 1 === step);
    });
}

function updateProgress() {
    const progressFill = document.getElementById('progressFill');
    const percentage = (currentStep / 4) * 100;
    progressFill.style.width = `${percentage}%`;
}

function updateStepStatus() {
    document.querySelectorAll('.step').forEach((el, index) => {
        const stepNum = index + 1;
        if (stepNum < currentStep) {
            el.classList.add('completed');
        } else {
            el.classList.remove('completed');
        }
    });
}

function resetGuide() {
    currentStep = 1;
    showStep(1);
    updateProgress();
    updateStepStatus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
